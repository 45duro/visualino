<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Visualino - RoboBlocks PlayGround</title>
    <link rel="stylesheet" type="text/css" href="visualino.css">
    <link rel="stylesheet" type="text/css" href="javascript/highlight/styles/default.css">
</head>
<body>
    <div id="wrap">
        <div id="blockly" style="float: left; width: 66%;"></div>
        <div id="code" style="float: right; width: 34%;"></div>
    </div>
    <script src="javascript/jquery/dist/jquery.min.js"></script>
    <script src="javascript/underscore/underscore.js"></script>
    <script src="javascript/highlight/highlight.pack.js"></script>
    <script src="javascript/blockly-bq/blockly_compressed.js"></script>
    <script src="javascript/blockly-bq/blocks_compressed.js"></script>
    <script src="javascript/blockly-bq/arduino_compressed.js"></script>
    <script src="roboblocks.js"></script>
    <script>
            if (window.roboblocksLanguage === undefined
                || window.roboblocksLanguage == null) {
                var roboblocksLanguage = 'en-GB';
            }
            RoboBlocks.load({
                zoom:1.0
            });
            // New workspace for each test case
            var el = document.getElementById('blockly');
            Blockly.inject(el, {
                toolbox: Blockly.createToolbox()
            });
            $('.blocklySvg, #blockly').height('100%');
            $('.blocklySvg').width('100%');

            // Update code
            Blockly.addChangeListener(function () {
                $('#code').html('<code class="c++"><pre>'
                    + escapeCode(Blockly.Arduino.workspaceToCode())
                    + '</pre></code>');
                // Highlight
                $("pre").each(function (i, e) {
                  hljs.highlightBlock(e);
                });
                // webHelper is injected in Visualino
                webHelper.sourceChanged();
            });

            // Show/hide code
            function toogleCode() {
                if ($('#code').css('display') == 'none') {
                    // Show
                    $('#code').show();
                    $('#blockly').width('66%');
                } else {
                    // Hide
                    $('#code').hide();
                    $('#blockly').width('100%');
                }
                // Resize workspace
                Blockly.fireUiEvent(window, "resize");
            }

            function escapeCode(code) {
                var str = code;
                str = str.replace(/</g, "&lt;");
                str = str.replace(/>/g, "&gt;");
                return str;
            }

            // Activate highlight library
            // hljs.initHighlightingOnLoad();
    </script>
</body>
</html>
